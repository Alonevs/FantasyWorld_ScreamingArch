{% load static %}
{% load custom_filters %}
{# Component: Children Tabs - Organizes entities into 3 categories #}
{# Args: children (list of entity dicts id/level calculated from id length) #}

<div class="mb-8">
    {# Tab Navigation (Horizontal Joined Pill Style - Dark "Negrecido" Glow) #}
    <div class="flex flex-row items-center justify-center mb-6">
        <!-- COSMOLOGY (Left) -->
        <button onclick="switchTab('cosmology')" id="tab-cosmology" class="tab-btn group px-5 py-2 rounded-l-full rounded-r-none bg-black/50 backdrop-blur-md border border-white/10 border-r-0 text-gray-300 text-[11px] font-bold uppercase tracking-widest hover:bg-black/90 hover:text-white hover:shadow-[0_0_15px_rgba(255,b255,255,0.1)] transition-all duration-300 flex items-center gap-2 shadow-lg z-30">
            <span class="text-sm group-hover:scale-110 transition-transform text-purple-400/80">üåå</span> 
            <span>Cosmolog√≠a</span>
            <span id="count-cosmology" class="ml-1 text-[9px] bg-white/10 px-1.5 py-0.5 rounded-full text-white/50 font-mono">0</span>
        </button>
        
        <!-- GEOGRAPHY (Middle) -->
        <button onclick="switchTab('geography')" id="tab-geography" class="tab-btn group px-5 py-2 rounded-none bg-black/50 backdrop-blur-md border border-white/10 text-gray-300 text-[11px] font-bold uppercase tracking-widest hover:bg-black/90 hover:text-white hover:shadow-[0_0_15px_rgba(255,255,255,0.1)] transition-all duration-300 flex items-center gap-2 shadow-lg z-20">
            <span class="text-sm group-hover:scale-110 transition-transform text-green-400/80">üó∫Ô∏è</span> 
            <span>Geograf√≠a</span>
            <span id="count-geography" class="ml-1 text-[9px] bg-white/10 px-1.5 py-0.5 rounded-full text-white/50 font-mono">0</span>
        </button>
        
        <!-- POPULATION (Right) -->
        <button onclick="switchTab('population')" id="tab-population" class="tab-btn group px-5 py-2 rounded-r-full rounded-l-none bg-black/50 backdrop-blur-md border border-white/10 border-l-0 text-gray-300 text-[11px] font-bold uppercase tracking-widest hover:bg-black/90 hover:text-white hover:shadow-[0_0_15px_rgba(255,255,255,0.1)] transition-all duration-300 flex items-center gap-2 shadow-lg z-10">
            <span class="text-sm group-hover:scale-110 transition-transform text-blue-400/80">üë•</span> 
            <span>Poblaci√≥n</span>
            <span id="count-population" class="ml-1 text-[9px] bg-white/10 px-1.5 py-0.5 rounded-full text-white/50 font-mono">0</span>
        </button>
    </div>

    {# Tab Content Panels (Logic remains same, just ensuring HTML structure is intake) #}
    <div id="panel-cosmology" class="tab-panel hidden animate-wave">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 entity-grid">
            {% for entity in children %}
                <!-- Levels 1-6 (2-12 chars): First Borns Only (Must end in '01') -->
                {% if entity.id|length <= 12 and entity.id|slice:"-2:" == "01" %}  
                    {% include "components/_entity_card.html" with entity=entity variant="vertical" %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div id="panel-geography" class="tab-panel hidden animate-wave">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 entity-grid">
            {% for entity in children %}
                <!-- Levels 7-11 (14-22 chars): Continents, Regions -->
                {% if entity.id|length >= 14 and entity.id|length <= 22 %}  
                    {% include "components/_entity_card.html" with entity=entity variant="vertical" %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div id="panel-population" class="tab-panel hidden animate-wave">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 entity-grid">
            {% for entity in children %}
                <!-- Levels 12+ (24+ chars) -->
                {% if entity.id|length >= 24 %}  
                    {% include "components/_entity_card.html" with entity=entity variant="vertical" %}
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<script>
function switchTab(tabName) {
    // Hide all panels
    document.querySelectorAll('.tab-panel').forEach(p => {
        p.classList.add('hidden');
        p.classList.remove('animate-wave');
    });
    
    // Reset buttons (keep base styles, remove active highlights)
    document.querySelectorAll('.tab-btn').forEach(btn => {
        // Base state: text-gray-300, bg-black/80
        btn.classList.add('text-gray-300', 'bg-black/80', 'border-white/10');
        btn.classList.remove('text-white', 'bg-black', 'border-white/30', 'shadow-[0_0_20px_rgba(0,0,0,0.8)]', 'z-40');
        
        // Remove color specific borders if any (cleaned up)
        btn.classList.remove('shadow-[0_0_15px_rgba(168,85,247,0.4)]', 'shadow-[0_0_15px_rgba(34,197,94,0.4)]', 'shadow-[0_0_15px_rgba(59,130,246,0.4)]');
    });
    
    // Show selected panel
    const panel = document.getElementById('panel-' + tabName);
    panel.classList.remove('hidden');
    void panel.offsetWidth; // Trigger reflow
    panel.classList.add('animate-wave');
    
    // Activate button (Dark Glow)
    const activeBtn = document.getElementById('tab-' + tabName);
    activeBtn.classList.remove('text-gray-300', 'bg-black/80', 'border-white/10');
    // Active: Blacker, stronger text, subtle dark glow
    activeBtn.classList.add('text-white', 'bg-black', 'border-white/30', 'shadow-[0_0_20px_rgba(0,0,0,0.8)]', 'z-40');
    
    // Optional: Very subtle glow (optional, maybe remove if user wants "no marca blanca")
    // Keep it removed for now to satisfy "no se diferencie... con esa marca tan blanca". 
    // Just text color change and slight bg lift is enough.

    localStorage.setItem('activeTab', tabName);
}

document.addEventListener('DOMContentLoaded', () => {
    // Update Counters
    ['cosmology', 'geography', 'population'].forEach(area => {
        const panel = document.getElementById('panel-' + area);
        const count = panel.querySelectorAll('.entity-grid > a').length;
        document.getElementById('count-' + area).textContent = count;
    });

    const savedTab = localStorage.getItem('activeTab') || 'cosmology';
    switchTab(savedTab);
});
</script>
