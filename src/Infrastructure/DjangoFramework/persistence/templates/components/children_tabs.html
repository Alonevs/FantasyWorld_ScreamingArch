{% load static %}
{% load custom_filters %}
{# Component: Children Tabs - Organizes entities into 3 categories #}
{# Args: children (list of entity dicts id/level calculated from id length) #}

<div class="mb-8">
    {# Tab Navigation (Horizontal Joined Pill Style - Dark "Negrecido" Glow) #}
    {# Tab Navigation (Solid Industrial Pills) #}
    <div class="flex flex-row items-center justify-center mb-6">
        <!-- COSMOLOGY (Left) -->
        <button onclick="switchTab('cosmology')" id="tab-cosmology" class="tab-btn group px-6 py-2.5 rounded-l-lg border-y border-l border-r-0 border-gray-800 bg-[#0a0a12] text-gray-500 hover:text-white hover:bg-[#151520] transition-all duration-200 flex items-center gap-2 z-10">
            <span class="text-sm grayscale group-hover:grayscale-0 transition-all opacity-70 group-hover:opacity-100">üåå</span> 
            <span class="text-[10px] font-bold uppercase tracking-widest">Cosmolog√≠a</span>
            <span id="count-cosmology" class="ml-1 text-[9px] bg-gray-800 text-gray-400 px-1.5 py-0.5 rounded font-mono group-hover:bg-purple-900/30 group-hover:text-purple-400">0</span>
        </button>
        
        <!-- GEOGRAPHY (Middle) -->
        <button onclick="switchTab('geography')" id="tab-geography" class="tab-btn group px-6 py-2.5 border-y border-l border-r border-gray-800 bg-[#0a0a12] text-gray-500 hover:text-white hover:bg-[#151520] transition-all duration-200 flex items-center gap-2 z-10">
            <span class="text-sm grayscale group-hover:grayscale-0 transition-all opacity-70 group-hover:opacity-100">üó∫Ô∏è</span> 
            <span class="text-[10px] font-bold uppercase tracking-widest">Geograf√≠a</span>
            <span id="count-geography" class="ml-1 text-[9px] bg-gray-800 text-gray-400 px-1.5 py-0.5 rounded font-mono group-hover:bg-green-900/30 group-hover:text-green-400">0</span>
        </button>
        
        <!-- POPULATION (Right) -->
        <button onclick="switchTab('population')" id="tab-population" class="tab-btn group px-6 py-2.5 rounded-r-lg border-y border-r border-l-0 border-gray-800 bg-[#0a0a12] text-gray-500 hover:text-white hover:bg-[#151520] transition-all duration-200 flex items-center gap-2 z-10">
            <span class="text-sm grayscale group-hover:grayscale-0 transition-all opacity-70 group-hover:opacity-100">üë•</span> 
            <span class="text-[10px] font-bold uppercase tracking-widest">Poblaci√≥n</span>
            <span id="count-population" class="ml-1 text-[9px] bg-gray-800 text-gray-400 px-1.5 py-0.5 rounded font-mono group-hover:bg-blue-900/30 group-hover:text-blue-400">0</span>
        </button>
    </div>

    {# Tab Content Panels (Logic remains same, just ensuring HTML structure is intake) #}
    <div id="panel-cosmology" class="tab-panel hidden animate-wave">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 entity-grid">
            {% for entity in children %}
                <!-- Levels 1-6 (2-12 chars): Cosmology Index -->
                {% if entity.id|length <= 12 %}  
                    {% include "components/_entity_card.html" with entity=entity variant="vertical" %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div id="panel-geography" class="tab-panel hidden animate-wave">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 entity-grid">
            {% for entity in children %}
                <!-- Levels 7-11 (14-22 chars): Continents, Regions -->
                {% if entity.id|length >= 14 and entity.id|length <= 22 %}  
                    {% include "components/_entity_card.html" with entity=entity variant="vertical" %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div id="panel-population" class="tab-panel hidden animate-wave">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 entity-grid">
            {% for entity in children %}
                <!-- Levels 12+ (24+ chars) -->
                {% if entity.id|length >= 24 %}  
                    {% include "components/_entity_card.html" with entity=entity variant="vertical" %}
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<script>
function switchTab(tabName) {
    // Hide all panels
    document.querySelectorAll('.tab-panel').forEach(p => {
        p.classList.add('hidden');
        p.classList.remove('animate-wave');
    });
    
    // Reset buttons (keep base styles, remove active highlights)
    // Reset buttons (Solid Dark Mode)
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.add('text-gray-500', 'bg-[#0a0a12]', 'border-gray-800');
        btn.classList.remove('text-white', 'bg-[#1a1a2e]', 'border-white/20', 'shadow-lg', 'z-40', 'scale-105');
        
        // Reset counters
        const badge = btn.querySelector('span[id^="count-"]');
        if(badge) {
            badge.classList.add('bg-gray-800', 'text-gray-400');
            badge.classList.remove('bg-purple-600', 'text-white', 'bg-green-600', 'bg-blue-600');
        }
    });
    
    // Show selected panel
    const panel = document.getElementById('panel-' + tabName);
    panel.classList.remove('hidden');
    void panel.offsetWidth; // Trigger reflow
    panel.classList.add('animate-wave');
    
    // Activate button (High Contrast Industrial)
    const activeBtn = document.getElementById('tab-' + tabName);
    activeBtn.classList.remove('text-gray-500', 'bg-[#0a0a12]', 'border-gray-800');
    activeBtn.classList.add('text-white', 'bg-[#1a1a2e]', 'border-white/20', 'shadow-lg', 'z-40', 'scale-105');
    
    // Colorize specific badges
    const activeBadge = activeBtn.querySelector('span[id^="count-"]');
    if(activeBadge) {
        activeBadge.classList.remove('bg-gray-800', 'text-gray-400');
        if(tabName === 'cosmology') activeBadge.classList.add('bg-purple-600', 'text-white');
        if(tabName === 'geography') activeBadge.classList.add('bg-green-600', 'text-white');
        if(tabName === 'population') activeBadge.classList.add('bg-blue-600', 'text-white');
    }

    localStorage.setItem('activeTab', tabName);
}

document.addEventListener('DOMContentLoaded', () => {
    // Update Counters
    ['cosmology', 'geography', 'population'].forEach(area => {
        const panel = document.getElementById('panel-' + area);
        const count = panel.querySelectorAll('.entity-grid > a').length;
        document.getElementById('count-' + area).textContent = count;
    });

    const savedTab = localStorage.getItem('activeTab') || 'cosmology';
    switchTab(savedTab);
});
</script>
