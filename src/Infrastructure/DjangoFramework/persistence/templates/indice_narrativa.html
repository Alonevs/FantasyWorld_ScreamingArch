{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Biblioteca | {{ world.name }}</title>
    <style>
        body { background-color: #0a0a12; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px 40px; }
        a { text-decoration: none; color: inherit; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: #0e0e16; padding: 15px 20px; border-radius: 10px; border-bottom: 1px solid #333; }
        .nav-btn { background: #333; color: #fff; padding: 8px 15px; border-radius: 5px; border: 1px solid #444; cursor: pointer; margin-left: 5px; }
        .nav-btn:hover { background: #555; }

        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 300px; gap: 30px; }

        .sidebar { background: #13131f; padding: 20px; border-radius: 10px; height: fit-content; }

        h1 { color: #d633ff; margin-top: 0; border-bottom: 2px solid #333; padding-bottom: 10px; }
        h2 { color: #a0a0ff; border-bottom: 1px solid #333; padding-bottom: 5px; margin-top: 30px; font-size: 1.2em; }

        .lore-card { background: #1f1f2e; border: 1px solid #333; padding: 15px; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .lore-card:hover { border-color: #d633ff; transform: translateX(5px); }
        .lore-title { font-weight: bold; font-size: 1.1em; }
        .lore-meta { font-size: 0.8em; color: #888; }
        .tag { font-size: 0.7em; padding: 2px 6px; background: #000; border-radius: 4px; color: #d633ff; border: 1px solid #444; margin-right: 10px; }

        .btn-create { display: block; width: 100%; padding: 10px; background: #d633ff; color: white; text-align: center; border-radius: 5px; font-weight: bold; margin-bottom: 10px; border: none; cursor: pointer; }
        .btn-create:hover { background: #b02ce0; }
        
        select, input { width: 100%; padding: 8px; background: #000; border: 1px solid #444; color: white; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="top-bar">
        <div style="font-weight:bold; font-size:1.5em;">BIBLIOTECA</div>
        <div>
            <a href="{% url 'ver_mundo' world.id %}" class="nav-btn">‚¨Ö Volver al Mundo</a>
            <a href="{% url 'home' %}" class="nav-btn">üè† Inicio</a>
        </div>
    </div>

    <div class="container">
        <div class="main-col">
            <h1>{{ world.name }} <span style="font-size:0.5em; color:#666;">ARCHIVO</span></h1>
            
            {% if lores %}
                <h2>üìú Lores & Fundamentos</h2>
                <div class="narrative-tree">
                    {% for l in lores %}
                        {% include "components/_narrativa_tree_item.html" with node=l %}
                    {% endfor %}
                </div>
            {% endif %}

            {% if historias %}
                <h2>üìñ Historias & Cap√≠tulos</h2>
                <div class="narrative-tree">
                    {% for h in historias %}
                        {% include "components/_narrativa_tree_item.html" with node=h %}
                    {% endfor %}
                </div>
            {% endif %}

            {% if not lores and not historias %}
                <div style="text-align:center; padding:50px; color:#666; border:2px dashed #333;">La biblioteca est√° vac√≠a.</div>
            {% endif %}
        </div>

        <div class="sidebar">
            <h3 style="margin-top:0; color:#fff;">Crear R√°pido</h3>
            
            <a href="{% url 'pre_crear_root' world.id 'L' %}" class="btn-create" style="background:#8e44ad; text-align:center; display:block; margin-bottom:5px; text-decoration:none;">+ üìú LORE</a>
            <a href="{% url 'pre_crear_root' world.id 'H' %}" class="btn-create" style="background:#2980b9; text-align:center; display:block; margin-bottom:5px; text-decoration:none;">+ üìñ HISTORIA</a>
            <a href="{% url 'pre_crear_root' world.id 'M' %}" class="btn-create" style="background:#d35400; text-align:center; display:block; margin-bottom:5px; text-decoration:none;">+ üïØÔ∏è LEYENDA</a>
            <a href="{% url 'pre_crear_root' world.id 'R' %}" class="btn-create" style="background:#7f8c8d; text-align:center; display:block; margin-bottom:5px; text-decoration:none;">+ ‚öñÔ∏è REGLA</a>
        </div>
    </div>

    <!-- Removed Creation Modal -->

    <script>
        // Tree Interaction Logic
        // Tree Interaction Logic
        function toggleNarrative(event, nid, hasChildren) {
            // Prevent event from bubbling so clicking arrow doesn't trigger card navigation
            event.stopPropagation(); 

            // Only toggle if there are children
            if (!hasChildren) return;

            const childrenDiv = document.getElementById('children-' + nid);
            const chevron = document.getElementById('chevron-' + nid);

            if (childrenDiv.style.display === 'none') {
                // Expand
                childrenDiv.style.display = 'block';
                if(chevron) chevron.style.transform = 'rotate(90deg)';
            } else {
                // Collapse
                childrenDiv.style.display = 'none';
                if(chevron) chevron.style.transform = 'rotate(0deg)';
            }
        }

        function navigateToNarrative(url) {
            window.location.href = url;
        }
    </script>
</body>
</html>