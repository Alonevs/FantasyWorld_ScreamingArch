{% extends "layouts/base.html" %}
{% block title %}SupervisiÃ³n: {{ target_user.context_username }} - ECLAI{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-5xl">
    
    <!-- HEADER -->
    <div class="flex items-center gap-4 mb-8">
        {% if target_user != user %}
        <a href="{% url 'my_team' %}" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors text-xl">
            â¬…
        </a>
        {% endif %}
        <div>
            <h2 class="text-3xl font-extrabold text-white">
                {% if target_user == user %}
                    Mi Espacio de <span class="text-emerald-400">Trabajo</span>
                {% elif target_user.profile in user.profile.bosses.all %}
                    Viendo perfil de <span class="text-amber-400">Jefe</span>: {{ target_user.username }}
                {% else %}
                    Supervisando a <span class="text-blue-400">{{ target_user.username }}</span>
                {% endif %}
            </h2>
            <div class="flex items-center gap-3 mt-1">
                <p class="text-gray-400 text-sm">
                    <span class="bg-gray-800 px-2 py-0.5 rounded text-xs font-mono uppercase tracking-widest text-gray-300">
                        {{ target_user.profile.get_rank_display }}
                    </span>
                </p>
                <!-- MANAGE LINK -->
                {% if target_user == user %}
                <a href="{% url 'dashboard' %}" class="text-xs bg-purple-900/30 hover:bg-purple-600 border border-purple-900/50 text-purple-300 hover:text-white px-3 py-1 rounded-full transition flex items-center gap-1 group">
                    <span>ğŸ›ï¸ Panel de Control</span>
                    <span class="opacity-50 group-hover:opacity-100">â†’</span>
                </a>
                {% endif %}
                {% if target_user != user and not target_user.profile in user.profile.bosses.all %}
                <a href="{% url 'dashboard' %}?author={{ target_user.id }}" class="text-xs bg-blue-900/30 hover:bg-blue-600 border border-blue-900/50 text-blue-300 hover:text-white px-3 py-1 rounded-full transition flex items-center gap-1 group">
                    <span>ğŸ›ï¸ Gestionar Propuestas</span>
                    <span class="opacity-50 group-hover:opacity-100">â†’</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    {% if permission_denied %}
        <div class="bg-red-500/10 border border-red-500 text-red-400 p-8 rounded-xl text-center">
            â›” No tienes permiso para supervisar a este usuario.
        </div>
    {% else %}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- COLUMN 1: WORLDS -->
            <div class="bg-[#0f0f0f] rounded-xl p-6 border border-white/5">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    ğŸŒ Mundos Creados
                    <span class="bg-white/10 text-xs px-2 py-0.5 rounded-full">{{ worlds|length }}</span>
                </h3>
                
                {% if worlds %}
                    <div class="space-y-3">
                        {% for w in worlds %}
                            <a href="{% url 'ver_mundo' w.id %}" class="block group p-4 rounded-lg bg-[#1a1a1a] hover:bg-[#222] border border-white/5 hover:border-blue-500/30 transition-all">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-gray-200 group-hover:text-blue-400 transition-colors">{{ w.name }}</h4>
                                    {% if w.is_public %}
                                        <span class="text-[10px] bg-green-500/10 text-green-400 px-1.5 rounded border border-green-500/20">PÃšBLICO</span>
                                    {% else %}
                                        <span class="text-[10px] bg-gray-500/10 text-gray-400 px-1.5 rounded border border-gray-500/20">PRIVADO</span>
                                    {% endif %}
                                </div>
                                <p class="text-xs text-gray-500 mt-1 line-clamp-2">{{ w.description }}</p>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500 italic text-sm">No ha creado mundos todavÃ­a.</p>
                {% endif %}
            </div>

            <!-- COLUMN 2: RECENT NARRATIVES -->
            <div class="bg-[#0f0f0f] rounded-xl p-6 border border-white/5">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    ğŸ“œ Narrativa Reciente
                    <span class="bg-white/10 text-xs px-2 py-0.5 rounded-full">{{ narratives|length }}</span>
                </h3>

                {% if narratives %}
                    <div class="space-y-3">
                        {% for n in narratives %}
                            <a href="{% url 'leer_narrativa' n.public_id %}" class="block group p-4 rounded-lg bg-[#1a1a1a] hover:bg-[#222] border border-white/5 hover:border-purple-500/30 transition-all">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-gray-200 group-hover:text-purple-400 transition-colors truncate max-w-[200px]">{{ n.titulo }}</h4>
                                    <span class="text-xs text-gray-600">{{ n.updated_at|date:"d M" }}</span>
                                </div>
                                <div class="flex gap-2 mt-2">
                                     <span class="text-[10px] uppercase bg-white/5 px-1.5 rounded text-gray-400">{{ n.world.name }}</span>
                                     <span class="text-[10px] uppercase bg-white/5 px-1.5 rounded text-gray-400">{{ n.tipo }}</span>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500 italic text-sm">No ha escrito narrativas recientes.</p>
                {% endif %}
            </div>

        </div>

    {% endif %}

</div>
{% endblock %}
