{% extends "layouts/base.html" %}

{% block content %}
<div class="min-h-screen bg-[#050510] pb-32"> <!-- Padding bottom for sticky footer -->
    
    <!-- HEADER -->
    <div class="bg-gray-900 border-b border-gray-800 p-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <a href="{% url 'dashboard' %}" class="text-gray-500 hover:text-white mb-2 inline-flex items-center gap-1 text-sm bg-gray-800 px-3 py-1 rounded-full transition-colors">
                    <span>‚Üê</span> Volver al Dashboard
                </a>
                <h1 class="text-2xl font-bold text-white mt-2 flex items-center gap-3">
                    <span class="text-yellow-400">üïµÔ∏è</span> 
                    Revisi√≥n de {{ proposal_type }}
                </h1>
                <p class="text-gray-400 text-sm mt-1">
                    Comparando versi√≥n 
                    <span class="text-green-400 font-mono">LIVE (Izquierda)</span> vs 
                    <span class="text-blue-400 font-mono">PROPUESTA (Derecha)</span>
                </p>
            </div>
            
            <!-- META INFO & HEADER ACTIONS -->
            <div class="text-right flex items-center gap-4">
                <div class="bg-blue-900/30 border border-blue-500/30 px-4 py-2 rounded-lg text-left hidden lg:block">
                    <p class="text-xs text-blue-300 font-bold uppercase tracking-wider mb-1">Motivo del Cambio</p>
                    <p class="text-white text-sm max-w-md italic truncate">"{{ change_log|default:'Sin comentarios' }}"</p>
                </div>

                <!-- TOP ACTIONS (Backup for Footer) -->
                <form method="post" class="flex items-center gap-2">
                    {% csrf_token %}
                    <button name="action" value="reject" class="px-4 py-2 rounded-lg bg-red-900/20 text-red-400 border border-red-900/50 hover:bg-red-900/50 hover:text-white font-bold transition-all text-sm">
                        Rechazar
                    </button>
                    <button name="action" value="approve" class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-500 font-bold shadow-lg transition-all text-sm flex items-center gap-1">
                        <span>‚úì</span> Aprobar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT: SPLIT VIEW -->
    <div class="max-w-[1920px] mx-auto p-6 grid grid-cols-2 gap-0 border-l border-r border-[#2a2a35] min-h-[600px]">
        
        <!-- LEFT: LIVE / ORIGINAL -->
        <div class="pr-6 border-r border-[#2a2a35] relative">
             <div class="sticky top-0 bg-[#050510]/95 backdrop-blur z-10 py-4 border-b border-gray-800 mb-6 flex justify-between items-center">
                <h2 class="text-lg font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-gray-600"></span> Original (Live)
                </h2>
                {% if not live_title and not live_content and not image_url %}
                    <span class="text-xs bg-red-900/30 text-red-500 px-2 py-0.5 rounded">No existe (Ser√° Creado)</span>
                {% endif %}
            </div>
            
            <div class="prose prose-invert max-w-none text-gray-400">
                {% if proposal_type == 'IMAGE' %}
                    {% if live_image_url %}
                        <img src="{{ live_image_url }}" class="rounded-lg border border-gray-700 w-full opacity-50 grayscale hover:grayscale-0 transition-all">
                    {% else %}
                        <div class="aspect-video bg-gray-900 rounded-lg flex items-center justify-center border border-dashed border-gray-700">
                            <span class="text-gray-600">Sin imagen previa</span>
                        </div>
                    {% endif %}
                {% else %}
                    <!-- TEXT CONTENT -->
                    {% if live_title %}
                        <h3 class="text-xl text-gray-300 font-bold mb-4 border-b border-gray-800 pb-2">{{ live_title }}</h3>
                    {% endif %}
                    
                    {% if live_content %}
                        <div class="whitespace-pre-wrap font-mono text-sm leading-relaxed">{{ live_content|safe }}</div>
                    {% else %}
                        <p class="text-gray-600 italic">[Contenido vac√≠o o inexistente]</p>
                    {% endif %}
                {% endif %}
            </div>
        </div>

        <!-- RIGHT: PROPOSED / DRAFT -->
        <div class="pl-6 relative">
            <div class="sticky top-0 bg-[#050510]/95 backdrop-blur z-10 py-4 border-b border-gray-800 mb-6 flex justify-between items-center">
                <h2 class="text-lg font-bold text-blue-400 uppercase tracking-widest flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_10px_#3b82f6]"></span> Propuesta
                </h2>
                
                <!-- ACTIONS (Right next to "Pending") -->
                <!-- ACTIONS REMOVED (Redundant) -->
                <span class="text-[10px] text-gray-600 font-mono uppercase mr-2">Propuesta</span>
            </div>

            <div class="prose prose-invert max-w-none text-gray-400">
                {% if proposal_type == 'IMAGE' %}
                     {% if image_url %}
                        <img src="{{ image_url }}" class="rounded-lg border-2 border-blue-500/50 w-full shadow-[0_0_30px_-5px_rgba(59,130,246,0.2)]">
                    {% else %}
                        <p class="text-red-400">Error: No image found in proposal.</p>
                    {% endif %}
                {% else %}
                    <!-- TEXT DIFF -->
                    {% if diff_title %}
                        <h3 class="text-xl text-white font-bold mb-4 border-b border-blue-900/50 pb-2">
                            {{ diff_title|safe }}
                        </h3>
                    {% endif %}

                {% if diff_content %}
                    <div class="whitespace-pre-wrap font-mono text-sm leading-relaxed text-gray-400">{{ diff_content|safe }}</div>
                {% endif %}
                {% endif %}
            </div>
        </div>

    </div>

    <!-- STICKY FOOTER ACTIONS -->
    <div class="fixed bottom-0 left-0 right-0 bg-[#050510] border-t border-white/10 p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.9)] z-[9999]">
        <div class="max-w-7xl mx-auto flex items-center justify-between gap-6">
            <div class="text-gray-400 text-sm flex items-center gap-2">
                <span class="text-yellow-500">‚ö†Ô∏è</span>
                Estas a punto de modificar datos en <span class="text-white font-bold">Producci√≥n</span>.
            </div>
            
            <!-- Footer Actions Removed as per request -->
            <div class="flex items-center gap-4 opacity-50">
                 <span class="text-xs text-gray-500">Usa los controles superiores para gestionar.</span>
            </div>
        </div>
    </div>

</div>
{% endblock %}
